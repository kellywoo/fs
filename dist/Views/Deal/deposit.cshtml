@using mtopt.logic;
@using mtopt.model.EntitySales;
@using mtopt.rte.Encrypt;
@{
    ViewBag.Title = Basis.Parse.Localization("deposit_krw");
    Layout = "~/Views/Shared/mst_main.cshtml";
    //获取数据
    
    member Member = ViewBag.Member;
    IEnumerable<bank_account> BankAccounts = ViewBag.BankAccounts;
}
@section head{
    <style type="text/css">
    </style>
}
<div class="mn-container">
    <div class="row">
        <div class="col-xs-2">
            @{ Html.RenderPartial("~/Views/Shared/ctl_menu_user.cshtml"); }
        </div>
        <div class="col-xs-10">
            <div class="content-layout">
                <div class="mn-block asset-certificate-bottom">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#">@Basis.Parse.Localization("deposit_krw")</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active">
                            <form class="form-horizontal">
                                <div id="div_type_2" style="display:none;">
                                    <div class="row">
                                        <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("deposit_account_info")</p></div>
                                        <div class="col-xs-10">
                                            <table class="table table-bordered">
                                                <tr>
                                                    <td style="width:120px;">@Basis.Parse.Localization("issue_new_account")</td>
                                                    <td style="width:220px;">@Basis.Parse.Localization("deposit_bank_branch")</td>
                                                    <td style="width:100px;">@Basis.Parse.Localization("com_account_owner")</td>
                                                    <td>@Basis.Parse.Localization("com_account_num")</td>
                                                </tr>
                                                @foreach (bank_account BankAccount in BankAccounts)
                                                {
                                                    <tr>
                                                        <td>@BankAccount.bank.name</td>
                                                        <td>@BankAccount.bankname</td>
                                                        <td>@BankAccount.bankuser</td>
                                                        <td>@BankAccount.bankno</td>
                                                    </tr>
                                                }
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("deposit_method")</p></div>
                                        <div class="col-xs-4">
                                            <input id="cardtype" type="text" class="form-control" placeholder="交通银行" />
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("com_account_num")</p></div>
                                        <div class="col-xs-4"><input id="cardno" type="text" class="form-control" placeholder="6222600210028888888" /></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("com_sender_name")</p></div>
                                        <div class="col-xs-4"><input id="name" type="text" class="form-control" placeholder="张三" /></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("deposit_when_deposit_made")</p></div>
                                        <div class="col-xs-4"><input id="time" type="text" class="form-control" placeholder="2000-01-01 12:00:00" /></div>
                                    </div>
                                </div>
                                <div id="div_type_3" style="display:none;">
                                    <div class="row">
                                        <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("deposit_micro_payment")</p></div>
                                        <div class="col-xs-4">
                                            <img src="" id="wechatimg" style="width:100%;height:auto;" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("deposit_method")</p></div>
                                    <div class="col-xs-4">
                                        <select id="type" class="form-control">
                                            <option value="-1">@Basis.Parse.Localization("com_option_default")</option>
                                            <option value="1">@Basis.Parse.Localization("deposit_realtime_transfer")</option>
                                            <option value="2">@Basis.Parse.Localization("deposit_thru_bank")</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("deposit_amount")</p></div>
                                    <div class="col-xs-4"><input id="money" type="text" class="form-control" placeholder="0.00" /></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("com_memo")</p></div>
                                    <div class="col-xs-4"><input id="remarks" type="text" class="form-control" placeholder="@Basis.Parse.Localization("deposit_memo")" /></div>
                                </div>

                                <div class="row">
                                    <div class="col-xs-4 col-xs-offset-2"><a id="btn_enter" class="btn btn-block btn-orange">@Basis.Parse.Localization("deposit_request_deposit")</a></div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var pck = {
        menuid: "user",
        type: 1,
        is_weixn: function () {
            var ua = navigator.userAgent.toLowerCase();
            if (ua.match(/MicroMessenger/i) == "micromessenger") {
                return true;
            } else {
                return false;
            }
        },
        submit: function () {
            var money = m.node("#money").value();
            var remarks = m.node("#remarks").value();
            if (money.length <= 0) {
                engine.news("@Basis.Parse.Localization("deposit_enter_how_much")", 1800);
                return;
            }
            else{ pck.money = money; }
            //如果是微信支付
            if (pck.type == 1) {
                m.redirect("/Deal/yitongpay?money=" + money + "&remarks=" + remarks);
            }
            //如果是普通充值
            else{
                var cardtype = m.node("#cardtype").value();
                var cardno = m.node("#cardno").value();
                var name = m.node("#name").value();
                var time = m.node("#time").value();
                if (cardtype.length <= 0) {
                    engine.news("@Basis.Parse.Localization("deposit_enter_bank_name")", 1800);
                    return;
                }
                if (cardno.length <= 0) {
                    engine.news("@Basis.Parse.Localization("deposit_enter_account_num")", 1800);
                    return;
                }
                if (cardtype.length <= 0) {
                    engine.news("@Basis.Parse.Localization("deposit_enter_sender_name")", 1800);
                    return;
                }
                if (time.length <= 0) {
                    engine.news("@Basis.Parse.Localization("deposit_enter_sending_time")", 1800);
                    return;
                }
                engine.news("@Basis.Parse.Localization("com_processing_wait")", 9999, 6);
                //发送请求
                var ajax = m.ajax("@Href("~/Deal/api_deposit_submit")", null, function (jso) {
                    var jso = m.json.getObject(jso);
                    switch (jso.Error) {
                        case 0:
                            engine.news("@Basis.Parse.Localization("deposit_completed_request")", 99999, 6);
                            setTimeout(function () {
                                m.redirect("@Href("~/Deal/")" + jso.Data + ".html");
                            }, 1000);
                            break;
                        case -10000:
                            engine.news("@Basis.Parse.Localization("deposit_failed_request")", 1800);
                            break;
                        default:
                            engine.news(jso.Error, 2000);
                            break;
                    }
                });
                ajax.data.add("cardtype", cardtype);
                ajax.data.add("cardno", cardno);
                ajax.data.add("name", name);
                ajax.data.add("time", time);
                ajax.data.add("money", money);
                ajax.data.add("remarks", remarks);
                ajax.send();
            }
        },
        init: function ()
        {
            m.node(".mn-menu-user").addClass("active");
            m.node(".user-menu-deposit").addClass("active"); 
        }
    }
    pck.init();
    //载入时
    $(function () {
        m.node("#btn_enter").click(pck.submit);
        m.node("#type").on("change", function () {
            pck.type = m.node("#type").value();
            if (pck.type == 1) {
                m.node("#div_type_2").hide();
                m.node("#div_type_3").hide();
            }
            else if (pck.type == 2) {
                m.node("#div_type_2").show();
                m.node("#div_type_3").hide();
            }
            else {
                m.node("#div_type_2").hide();
                m.node("#div_type_3").show();
            }
        });
    });
</script>