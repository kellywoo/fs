@using System.Data;
@using mtopt.model;
@using mtopt.logic;
@using mtopt.model.EntitySales;
@{
    ViewBag.Title = Basis.Parse.Localization("user_login_action");
    Layout = "~/Views/Shared/mst_main.cshtml";
}
@section head{
    <style type="text/css">
        .login-register{background:url(/images/login-bg.jpg) no-repeat center;background-size:cover;height:750px}
        .form-login-register{width:440px;margin-left:auto;margin-right:auto;margin-top:118px;height:394px;background:#fff;box-shadow:0 0 15px #ccc;padding:45px 45px 20px 45px}
        .form-login-register h1{color:#e9504a;margin:0 0 45px 0}
        .form-login-register .form-control,.form-login-register .form-control:focus{border:none;box-shadow:none;border-bottom:1px solid #d1d1d1;border-radius:0;height:45px}
        .form-login-register.login input[type=password]{margin-bottom:50px}
        .form-login-register p{font-size:12px;color:#999;margin-top:20px;margin-bottom:15px}
        .form-login-register p a{color:#e9504a}
        .form-login-register.register,.form-login-register.reset-password{height:555px;margin-top:37px}
        .form-login-register #sendSms{top:7px;right:0}
        .form-login-register.reset-password button[type=submit]{margin-top:55px}
    </style>
}
<div class="login-register">
    <div class="mn-container">
        <div class="row">
            <div class="col-xs-12">
                <form class="form-login-register login">
                    <h1 class="center">@Basis.Parse.Localization("user_login_title")</h1>
                    <div class="form-group">
                        <input type="text" id="memberid" class="form-control" placeholder="@Basis.Parse.Localization("user_id")">
                    </div>
                    <div class="form-group">
                        <input type="password" id="password" class="form-control" placeholder="@Basis.Parse.Localization("user_pw")">
                    </div>
                    <a class="btn btn-orange btn-block btn-lg" id="btn_login">@Basis.Parse.Localization("user_login")</a>
                    <p class="center">
                        <a href="~/User/register">@Basis.Parse.Localization("user_signup")</a> | <a href="/User/find">@Basis.Parse.Localization("user_find_pw")？</a>
                    </p>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var pck = {
        init: function () {
            m.node(".login-register").keydown(function (event) {
                if (event.keyCode == 13) { m.node("#btn_login").click(); }
            });
        }
    }
    pck.init();
    m.node("#btn_login").click(function () {
        engine.news("@Basis.Parse.Localization("login_checking")", 99999, 6);
        var memberid = m.node("#memberid").value();
        var password = m.node("#password").value();
        if (memberid.length <= 0) {
            engine.news("@Basis.Parse.Localization("login_enter_id")", 1800);
            return;
        }
        if (password.length <= 0) {
            engine.news("@Basis.Parse.Localization("com_enter_pw")", 1800);
            return;
        }
        var ajax = m.ajax("@Href("~/User/api_login_submit")", null, function (obj) {
            var jso = m.json.getObject(obj);
            if (jso.Success == true) {
                engine.news("@Basis.Parse.Localization("welcome_login")", 99999, 6);
                if (m.queryString("url") != null) {
                    m.redirect(m.encry.url.decode(m.queryString("url")));
                }
                else {
                    m.redirect("@Href("~/Home/main")");
                }
            }
            else {
                if (jso.Error == -10003) {
                    engine.news("@Basis.Parse.Localization("com_vcode_wrong")", 1800);
                }
                else if (jso.Error == -10001) {
                    engine.news("@Basis.Parse.Localization("login_failed")", 1800);
                }
                else {
                    engine.news(jso.Data, 3000);
                }
            }
        });
        ajax.data.add("memberid", memberid);
        ajax.data.add("password", password);
        ajax.send();
    });
    m.node(".mn-menu-home").addClass("active");
</script>