@using mtopt.logic;
@using mtopt.model.EntitySales;
@using mtopt.rte.Encrypt;
@{
    ViewBag.Title = Basis.Parse.Localization("user_pw_edit");
    Layout = "~/Views/Shared/mst_main.cshtml";
    
}
@section head{
    <style type="text/css">
    </style>
}
<div class="mn-container">
    <div class="row">
        <div class="col-xs-2">
            @{ Html.RenderPartial("~/Views/Shared/ctl_menu_user.cshtml"); }
        </div>
        <div class="col-xs-10">
            <div class="content-layout">
                <div class="mn-block asset-certificate-bottom">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="~/User/wordedit">@Basis.Parse.Localization("user_pw_edit")</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active">
                            <form class="form-horizontal">
                                <div class="row">
                                    <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("user_new_pw")</p></div>
                                    <div class="col-xs-4">
                                        <input type="password" class="form-control" id="npassword" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("user_pw_reenter")</p></div>
                                    <div class="col-xs-4">
                                        <input type="password" class="form-control" id="cnpassword" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-2"><p class="mn-label right">@Basis.Parse.Localization("com_vcode")</p></div>
                                    <div class="col-xs-4">
                                        <div class="row">
                                            <div class="col-xs-7">
                                                <input id="checkcode" name="checkcode" type="text" class="form-control" placeholder="@Basis.Parse.Localization("user_vcode_enter")" required="required" />
                                            </div>
                                            <div class="col-xs-5">
                                                <input id="btn_sendcc" type="button" class="btn btn-success" value="@Basis.Parse.Localization("com_vcode_send")" style="width:100%;" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-4 col-xs-offset-2"><a id="btn_enter" class="btn btn-block btn-orange">@Basis.Parse.Localization("user_save")</a></div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var pck = {
        submit: function () {
            var npassword = m.node("#npassword").value();
            var cnpassword = m.node("#cnpassword").value();
            var checkcode = m.node("#checkcode").value();

            if (npassword.length <= 0) {
                engine.news("@Basis.Parse.Localization("user_new_trade_pw")", 1800);
                return;
            }
            if (npassword != cnpassword) {
                engine.news("@Basis.Parse.Localization("user_new_pw_different")", 1800);
                return;
            }
            if (checkcode.length <= 0) {
                engine.news("@Basis.Parse.Localization("com_vcode_enter")", 1800);
                return;
            }
            engine.news("@Basis.Parse.Localization("com_processing_wait")", 999999, 6);
            //发送请求
            var ajax = m.ajax("@Href("~/User/api_wordedit_submit")", null, function (jso) {
                var jso = m.json.getObject(jso);
                switch (jso.Error) {
                    case 0:
                        engine.news("@Basis.Parse.Localization("user_completed_change_info")", 3000, true);
                        break;
                   default:
                        engine.news(jso.Data, 1800);
                        break;
                }
            });
            ajax.data.add("npassword", npassword);
            ajax.data.add("checkcode", checkcode);
            ajax.send();
        },
        init: function () { }
    }
    pck.init();
    //载入时
    $(function () {
        m.node("#btn_enter").click(pck.submit);
        m.node(".mn-menu-user").addClass("active");
        m.node(".user-menu-wordedit").addClass("active");
    });
    /*******************绑定发送按钮********************/
    m.node("#btn_sendcc").click(function () {
        engine.news("@Basis.Parse.Localization("com_vcode_processing")", 99999, 6);
        var jso = m.post("@Href("~/User/fixedsend?memberid=" + Basis.Session.Uid)", null);
        jso = m.json.getObject(jso);
        //判断返回值
        switch (m.parse.toInteger(jso.Error)) {
            case 0:
                var btn = m.node("#btn_sendcc").first();
                mSpace().cctime = 60;
                //设置计时器
                var itl = setInterval(function () {
                    var sec = mSpace().cctime;
                    if (sec > 0) {
                        sec -= 1;
                        btn.disabled = true;
                        btn.value = "@Basis.Parse.Localization("com_wait")" + sec + "@Basis.Parse.Localization("com_seconds")";
                    }
                    else {
                        btn.disabled = false;
                        btn.value = "@Basis.Parse.Localization("com_vcode_request")";
                        clearInterval(itl);
                    }
                    mSpace().cctime = sec;
                }, 1000);
                        engine.news("@Basis.Parse.Localization("com_complete_sending")", 3000);
                break;
            case -10001:
            engine.news("@Basis.Parse.Localization("com_vcode_limited_time")", 3000);
                break;
            default:
                engine.news("@Basis.Parse.Localization("com_failed")", 3000);
                break;
        }
    });
</script>